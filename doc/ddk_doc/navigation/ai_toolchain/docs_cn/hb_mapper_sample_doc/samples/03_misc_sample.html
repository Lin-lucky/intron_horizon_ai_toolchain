<!DOCTYPE html>
<html class="writer-html5" lang="zh" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3. 其他示例 &mdash; horizon_model_convert_sample_documentation v1.12.3 文档</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom-style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="prev" title="2. 算法模型示例" href="02_algorithm_sample.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> horizon_model_convert_sample_documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_general_descriptions.html">1. 概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_algorithm_sample.html">2. 算法模型示例</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. 其他示例</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">3.1. 如何使用</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">3.2. 杂项示例</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#lenet-gray">3.2.1. lenet_gray</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">3.2.1.1. 目录结构</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">3.2.1.2. 示例内容</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#resnet50-feature">3.2.2. resnet50_feature</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">3.2.2.1. 目录结构</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">3.2.2.2. 示例内容</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vector-diff">3.2.3. vector-diff</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">3.2.3.1. 目录结构</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">3.2.3.2. 输出内容</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multi-input-example">3.2.4. multi_input_example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id10">3.2.4.1. 目录结构</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">3.2.4.2. 示例内容</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#model-verifier">3.2.5. model_verifier</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id12">3.2.5.1. 目录结构</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">3.2.5.2. 示例内容</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#model-info">3.2.6. model_info</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id14">3.2.6.1. 目录结构</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">3.2.6.2. 示例内容</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mobilenet-bgr">3.2.7. mobilenet_bgr</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id16">3.2.7.1. 目录结构</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">3.2.7.2. 示例内容</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mobilenet-yuv444">3.2.8. mobilenet_yuv444</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id18">3.2.8.1. 目录结构</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id19">3.2.8.2. 示例内容</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#op">3.3. 用户自定义OP示例</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id20">3.3.1. 目录结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">3.3.2. 示例介绍</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">horizon_model_convert_sample_documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">3. </span>其他示例</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/samples/03_misc_sample.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1><span class="section-number">3. </span>其他示例<a class="headerlink" href="#id1" title="永久链接至标题"></a></h1>
<p>其他示例是指05_miscellaneous/ 和 06_custom_op/ 文件夹中的示例。
其中，05_miscellaneous/是杂项示例，用于指导使用X3工具链提供的一些其他内容，
比如：如何使用地平线模型转换工具使RGB数据训练的模型能在Runtime运行时接受YUV数据。
06_custom_op/为用户自定义OP示例，帮助用户了解如何在模型含有工具链不支持的算子的情况下添加自定义算子的功能。</p>
<p>各示例用法、目录结构及内容请参照以下内容。</p>
<section id="id2">
<h2><span class="section-number">3.1. </span>如何使用<a class="headerlink" href="#id2" title="永久链接至标题"></a></h2>
<p>如上所示，在各子文件夹下，每个使用示例都按照顺序封装成了shell脚本，按照shell脚本顺序执行，
即可了解相应的工具的使用、API的功能以及用法等。</p>
</section>
<section id="id3">
<h2><span class="section-number">3.2. </span>杂项示例<a class="headerlink" href="#id3" title="永久链接至标题"></a></h2>
<section id="lenet-gray">
<h3><span class="section-number">3.2.1. </span>lenet_gray<a class="headerlink" href="#lenet-gray" title="永久链接至标题"></a></h3>
<section id="id4">
<h4><span class="section-number">3.2.1.1. </span>目录结构<a class="headerlink" href="#id4" title="永久链接至标题"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>01_lenet_gray/
.
└── mapper
    ├── 01_check.sh                 //对模型进行预验证
    ├── 02_get_mnist.sh             //获取校准数据
    ├── 03_build.sh                 //转换debug模型
    ├── 04_inference.sh             //使用onnx runtime进行推理
    ├── README.cn.md
    ├── lenet_gray_config.yaml
    ├── postprocess.py
    ├── preprocess.py
    └── process_mnist.py
</pre></div>
</div>
</section>
<section id="id5">
<h4><span class="section-number">3.2.1.2. </span>示例内容<a class="headerlink" href="#id5" title="永久链接至标题"></a></h4>
<p>该示例为灰度图模型的模型转换、模拟器运行及上板运行示例。</p>
</section>
</section>
<section id="resnet50-feature">
<h3><span class="section-number">3.2.2. </span>resnet50_feature<a class="headerlink" href="#resnet50-feature" title="永久链接至标题"></a></h3>
<section id="id6">
<h4><span class="section-number">3.2.2.1. </span>目录结构<a class="headerlink" href="#id6" title="永久链接至标题"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>02_resnet50_feature
.
└── mapper
    ├── 01_check.sh                 //对模型进行预验证
    ├── 02_build.sh                 //转换debug模型
    ├── 03_inference.sh             //使用onnx runtime进行推理
    ├── inference.py
    ├── README.cn.md
    └── resnet50_feature_config.yaml
</pre></div>
</div>
</section>
<section id="id7">
<h4><span class="section-number">3.2.2.2. </span>示例内容<a class="headerlink" href="#id7" title="永久链接至标题"></a></h4>
<p>该示例为resnet50_feature的模型转换, 模拟器运行及上板运行示例。</p>
</section>
</section>
<section id="vector-diff">
<h3><span class="section-number">3.2.3. </span>vector-diff<a class="headerlink" href="#vector-diff" title="永久链接至标题"></a></h3>
<section id="id8">
<h4><span class="section-number">3.2.3.1. </span>目录结构<a class="headerlink" href="#id8" title="永久链接至标题"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>03_vector_diff
.
└── mobilenet_mapper
    ├── 01_inference_rt.sh
    ├── 02_vec_diff.sh                  // 使用vec_diff工具进行输出数据分析
    ├── aarch64_x86_xj3
    <span class="p">|</span>   ├── bin
    <span class="p">|</span>   <span class="p">|</span>   ├── hrt_bin_dump
    <span class="p">|</span>   <span class="p">|</span>   └── hrt_model_exec
    <span class="p">|</span>   └── lib
    <span class="p">|</span>       ├── libdnn.so
    <span class="p">|</span>       └── libhbdk_sim_x86.so
    ├── ILSVRC2012_val_00000001.bin
    └── readme.txt
</pre></div>
</div>
</section>
<section id="id9">
<h4><span class="section-number">3.2.3.2. </span>输出内容<a class="headerlink" href="#id9" title="永久链接至标题"></a></h4>
<p>由 <code class="docutils literal notranslate"><span class="pre">vec_diff</span> <span class="pre">-o</span></code> 指定的CSV文件，列表（表项为：左侧文件名，右侧文件名，余弦相似度、相对欧拉距、最大绝对误差、方差），参考如下：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Left Files</p></th>
<th class="head"><p>Right Files</p></th>
<th class="head"><p>Cosine Similarity</p></th>
<th class="head"><p>Relative Euclidean Distance</p></th>
<th class="head"><p>Max Absolute Error</p></th>
<th class="head"><p>Mean Square Error</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Layerxxx-quanti-input.txt</p></td>
<td><p>Layerxxx-float-input.txt</p></td>
<td><p>xxx</p></td>
<td><p>xxx</p></td>
<td><p>xxx</p></td>
<td><p>xxx</p></td>
</tr>
<tr class="row-odd"><td><p>Layerxxx-quanti-param.txt</p></td>
<td><p>Layerxxx-float-param.txt</p></td>
<td><p>xxx</p></td>
<td><p>xxx</p></td>
<td><p>xxx</p></td>
<td><p>xxx</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="multi-input-example">
<h3><span class="section-number">3.2.4. </span>multi_input_example<a class="headerlink" href="#multi-input-example" title="永久链接至标题"></a></h3>
<section id="id10">
<h4><span class="section-number">3.2.4.1. </span>目录结构<a class="headerlink" href="#id10" title="永久链接至标题"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>04_multi_input_example
.
├── mapper
    ├── 01_check.sh                 // 对模型进行预验证
    ├── 02_preprocess.sh            // 对数据进行预处理
    ├── 03_build.sh                 // 转换debug模型
    ├── 04_inference.sh             // 使用onnx runtime进行推理
    ├── data_preprocess.py
    ├── data_transformer.py
    ├── inference.py
    └── mobilenet_multi_config.yaml
</pre></div>
</div>
</section>
<section id="id11">
<h4><span class="section-number">3.2.4.2. </span>示例内容<a class="headerlink" href="#id11" title="永久链接至标题"></a></h4>
<p>该示例为多输入模型的模型转换, 模拟器运行及上板运行示例。</p>
</section>
</section>
<section id="model-verifier">
<h3><span class="section-number">3.2.5. </span>model_verifier<a class="headerlink" href="#model-verifier" title="永久链接至标题"></a></h3>
<section id="id12">
<h4><span class="section-number">3.2.5.1. </span>目录结构<a class="headerlink" href="#id12" title="永久链接至标题"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>07_model_verifier
.
├── 01_preprocess.sh                // 对数据进行预处理
├── 02_build.sh                     // 转换debug模型
├── 03_model_verify.sh              // 执行模型验证
├── calibration_data_feature
├── data_preprocess.py
├── data_transformer.py
├── mobilenet_config_bgr.yaml
├── mobilenet_config_yuv444.yaml
└── resnet50_featuremap_config.yaml
</pre></div>
</div>
</section>
<section id="id13">
<h4><span class="section-number">3.2.5.2. </span>示例内容<a class="headerlink" href="#id13" title="永久链接至标题"></a></h4>
<p>该示例为模型验证工具的验证示例。</p>
</section>
</section>
<section id="model-info">
<h3><span class="section-number">3.2.6. </span>model_info<a class="headerlink" href="#model-info" title="永久链接至标题"></a></h3>
<section id="id14">
<h4><span class="section-number">3.2.6.1. </span>目录结构<a class="headerlink" href="#id14" title="永久链接至标题"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>08_model_info
.
├── 01_preprocess.sh                // 对数据进行预处理
├── 02_build.sh                     // 转换debug模型
├── 03_model_info_check.sh          // 执行模型信息检测并打印
├── mobilenet_config.yaml
└── preprocess.py
</pre></div>
</div>
</section>
<section id="id15">
<h4><span class="section-number">3.2.6.2. </span>示例内容<a class="headerlink" href="#id15" title="永久链接至标题"></a></h4>
<p>该示例为模型信息输出工具的验证示例。</p>
</section>
</section>
<section id="mobilenet-bgr">
<h3><span class="section-number">3.2.7. </span>mobilenet_bgr<a class="headerlink" href="#mobilenet-bgr" title="永久链接至标题"></a></h3>
<section id="id16">
<h4><span class="section-number">3.2.7.1. </span>目录结构<a class="headerlink" href="#id16" title="永久链接至标题"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>09_mobilenet_bgr
.
└── mapper
    ├── 01_check.sh               // 对数据模型做校验
    ├── 02_preprocess.sh          // 对数据进行预处理
    ├── 03_build.sh               // 模型转换
    ├── 04_inference.sh           // 单张图片进行推理
    ├── README.cn.md
    ├── mobilenet_config.yaml
    ├── postprocess.py
    └── preprocess.py
</pre></div>
</div>
</section>
<section id="id17">
<h4><span class="section-number">3.2.7.2. </span>示例内容<a class="headerlink" href="#id17" title="永久链接至标题"></a></h4>
<p>该示例为 MobileNetv1 模型,  <code class="docutils literal notranslate"><span class="pre">input_type_rt</span></code> 为 <code class="docutils literal notranslate"><span class="pre">bgr</span></code> 的示例。</p>
</section>
</section>
<section id="mobilenet-yuv444">
<h3><span class="section-number">3.2.8. </span>mobilenet_yuv444<a class="headerlink" href="#mobilenet-yuv444" title="永久链接至标题"></a></h3>
<section id="id18">
<h4><span class="section-number">3.2.8.1. </span>目录结构<a class="headerlink" href="#id18" title="永久链接至标题"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>10_mobilenet_yuv444
.
└── mapper
    ├── 01_check.sh               // 对数据模型做校验
    ├── 02_preprocess.sh          // 对数据进行预处理
    ├── 03_build.sh               // 模型转换
    ├── 04_inference.sh           // 单张图片进行推理
    ├── README.cn.md
    ├── mobilenet_config.yaml
    ├── postprocess.py
    └── preprocess.py
</pre></div>
</div>
</section>
<section id="id19">
<h4><span class="section-number">3.2.8.2. </span>示例内容<a class="headerlink" href="#id19" title="永久链接至标题"></a></h4>
<p>该示例为 MobileNetv1 模型,  <code class="docutils literal notranslate"><span class="pre">input_type_rt</span></code> 为 <code class="docutils literal notranslate"><span class="pre">yuv444</span></code> 的示例。</p>
</section>
</section>
</section>
<section id="op">
<h2><span class="section-number">3.3. </span>用户自定义OP示例<a class="headerlink" href="#op" title="永久链接至标题"></a></h2>
<section id="id20">
<h3><span class="section-number">3.3.1. </span>目录结构<a class="headerlink" href="#id20" title="永久链接至标题"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>06_custom_op
.
├── mapper
    ├── 02_preprocess.sh
    ├── 03_build.sh
    ├── 04_inference.sh
    ├── 05_evaluate.sh
    ├── cls_evaluate.py
    ├── cls_inference.py
    ├── googlenet_cop_config.yaml
    ├── onnx_modify.py
    ├── postprocess.py
    ├── preprocess.py
    ├── README.cn.md
    ├── sample_custom.py
    └── torch_export.py
</pre></div>
</div>
</section>
<section id="id21">
<h3><span class="section-number">3.3.2. </span>示例介绍<a class="headerlink" href="#id21" title="永久链接至标题"></a></h3>
<p>开发者使用地平线工具链将各开源框架训练得到的浮点模型转换为定点模型时，
如果浮点模型中包含了工具链不支持的算子（以下简称为OP），则会转换失败。
在此情况下，开发者可以使用工具链的自定义OP功能自行添加不支持的OP，完成模型转换。</p>
<p>自定义OP功能主要使用 <code class="docutils literal notranslate"><span class="pre">hb_custom_op</span></code> 工具的 <code class="docutils literal notranslate"><span class="pre">create</span></code> 命令行。
如上目录结构所示，在使用本示例时，进入01_custom_op_creator文件夹，
执行 <code class="docutils literal notranslate"><span class="pre">sh</span> <span class="pre">01_create_op.sh</span></code>，在当前目录下生成供用户修改的模板文件。</p>
<p>02_mapper文件夹中则包含了执行本示例所需要的脚本和配置文件。</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="02_algorithm_sample.html" class="btn btn-neutral float-left" title="2. 算法模型示例" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2021, horizon.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>