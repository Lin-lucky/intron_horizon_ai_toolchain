<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.7. The hb_model_modifier Tool &mdash; hb_mapper_tools_guide v1.12.3 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom-style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2.8. The hb_custom_op Tool" href="hb_custom_op.html" />
    <link rel="prev" title="2.6. The hb_model_verifier Tool" href="hb_model_verifier.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> hb_mapper_tools_guide
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01_model_conversion_details.html">1. Introduction To The Model Conversion Process</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../02_tools.html">2. Tools Usage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="hb_mapper.html">2.1. The <code class="docutils literal notranslate"><span class="pre">hb_mapper</span></code> Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="hb_perf.html">2.2. The <code class="docutils literal notranslate"><span class="pre">hb_perf</span></code> Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="vec_diff.html">2.3. The <code class="docutils literal notranslate"><span class="pre">vec_diff</span></code> Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_info.html">2.4. The <code class="docutils literal notranslate"><span class="pre">hb_model_info</span></code> Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="hb_pack.html">2.5. The <code class="docutils literal notranslate"><span class="pre">hb_pack</span></code> Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="hb_model_verifier.html">2.6. The <code class="docutils literal notranslate"><span class="pre">hb_model_verifier</span></code> Tool</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.7. The <code class="docutils literal notranslate"><span class="pre">hb_model_modifier</span></code> Tool</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use">2.7.1. How To Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameters">2.7.2. Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parse-the-output">2.7.3. Parse The Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="hb_custom_op.html">2.8. The <code class="docutils literal notranslate"><span class="pre">hb_custom_op</span></code> Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="hb_eval_preprocess.html">2.9. The <code class="docutils literal notranslate"><span class="pre">hb_eval_preprocess</span></code> Tool</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hb_mapper_tools_guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../02_tools.html"><span class="section-number">2. </span>Tools Usage</a> &raquo;</li>
      <li><span class="section-number">2.7. </span>The <code class="docutils literal notranslate"><span class="pre">hb_model_modifier</span></code> Tool</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/03_tools/hb_model_modifier.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="the-hb-model-modifier-tool">
<h1><span class="section-number">2.7. </span>The <code class="docutils literal notranslate"><span class="pre">hb_model_modifier</span></code> Tool<a class="headerlink" href="#the-hb-model-modifier-tool" title="Permalink to this headline"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">hb_model_modifier</span></code> tool is used for deleting Transpose and Quantize nodes in the input end of specified runtime
model. Information of the deleted nodes will be saved into the BIN model and can be viewed by the <code class="docutils literal notranslate"><span class="pre">hb_model_info</span></code> tool.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>This tool is used for deleteing the Transpose and Quantize nodes at the input end and deleting the Transpose or
Dequantize nodes at the output end. The Transpose node must input/output data directly.
The tool can only delete one Transpose or Quantize node at a time.
When deleting Dequantize node, the Dequantize node and all succeeding nodes will be deleted.
Therefore, the operations after Dequantize node will be put into post-processing.</p></li>
<li><p>For Transpose and Quantize nodes, all nodes between input node and the to-be-deleted node (if any)
are single input/output nodes. For Dequantize node, all nodes between output node and the to-be-deleted node (if any)
are single input/output nodes.</p></li>
<li><p>This tool cannot process packed models, otherwise it will print: <code class="docutils literal notranslate"><span class="pre">ERROR</span> <span class="pre">pack</span> <span class="pre">model</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">supported</span></code>.</p></li>
<li><p>The Quantize node will convert data type from floating-point into fixed-point.
So after deleting it, users will need to convert the data type at model input end into fix-point.
The Dequantize node will convert data type from fixed-point into floating-point.
So after deleting it, users will need to convert the data type at model output end into floating-point and
implement post-processing.</p></li>
</ol>
</div>
<section id="how-to-use">
<h2><span class="section-number">2.7.1. </span>How To Use<a class="headerlink" href="#how-to-use" title="Permalink to this headline"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>hb_model_modifier <span class="si">${</span><span class="nv">model_file</span><span class="si">}</span> -r <span class="si">${</span><span class="nv">node_name</span><span class="si">}</span>
</pre></div>
</div>
</section>
<section id="parameters">
<h2><span class="section-number">2.7.2. </span>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline"></a></h2>
<dl class="py data">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">hb_model_modifier's</span> <span class="pre">parameters</span></span></dt>
<dd><dl class="simple">
<dt>model_file</dt><dd><p>This parameter specifies the file name of runtime model.</p>
</dd>
</dl>
<dl class="option-list">
<dt><kbd><span class="option">-r</span></kbd></dt>
<dd><p>This parameter specifies the name of the to-be-deleted node.</p>
</dd>
<dt><kbd><span class="option">-o</span></kbd></dt>
<dd><p>This parameter specifies the output name of the modified model (it only becomes valid when the <code class="docutils literal notranslate"><span class="pre">-r</span></code> is added)</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="parse-the-output">
<h2><span class="section-number">2.7.3. </span>Parse The Output<a class="headerlink" href="#parse-the-output" title="Permalink to this headline"></a></h2>
<p>If there isn’t any parameters specified after the command-line, the tool will print candidate nodes to be deleted
(all transpose, quanti and dequantize nodes in the model).
The formula to calculate quanti node is: <span class="math notranslate nohighlight">\(qx = clamp(round(x / scale) + zero\_point, -128, 127)\)</span>,
wherein the <cite>round(x)</cite> implements floating-point round-off, while the <cite>clamp(x)</cite> function implements clamping data into the integer range between -128 and 127.
While the formula to calculate dequantize node is: <span class="math notranslate nohighlight">\(deqx = (x - zero\_point) * scale\)</span>, when deqx is resized back to float or double
type values and the quanti node is deleted, model input type will be int8; and when the dequantize node is deleted, model
input type will be either int8 or int32. the <cite>zero_point</cite> refers to the offset value of those <cite>zero_point`s in asymmetric quantization.
While `zero_point = 0</cite> in symmetric quantization.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The tool can support deleting:</p>
<ol class="arabic simple">
<li><p>quanti or transpose nodes at input part;</p></li>
<li><p>dequantize or transpose nodes at output part.</p></li>
</ol>
<p>Therefore, users will need to confirm by themselves that the deleted quanti node(s) must be before BPU input;
while that the deleted dequantize node(s) must be after BPU input.</p>
</div>
<p>Tool printed message is shown as below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>hb_model_modifier resnet50_64x56x56_feature.bin
<span class="m">2021</span>-04-07 <span class="m">11</span>:37:47,035 INFO Nodes that might be deleted: <span class="o">[</span><span class="s1">&#39;data_res2a_branch1_HzQuantize_TransposeInput0&#39;</span>, <span class="s1">&#39;data_res2a_branch1_HzQuantize&#39;</span><span class="o">]</span>
<span class="m">2021</span>-04-07 <span class="m">11</span>:37:47,035 INFO Please make sure node is input node before delete it !!!
</pre></div>
</div>
<p>When the <code class="docutils literal notranslate"><span class="pre">-r</span></code> option is specified, the tool will print model node type and save into the node information in bin file
and tell users that the specified node has been deleted. As shown below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>hb_model_modifier resnet50_64x56x56_feature.bin -r data_res2a_branch1_HzQuantize
Node <span class="s1">&#39;data_res2a_branch1_HzQuantize&#39;</span> found, its OP <span class="nb">type</span> is <span class="s1">&#39;Quantize&#39;</span>
Node info <span class="s1">&#39;data_res2a_branch1_HzQuantize: [0.13579604029655457]&#39;</span> saved
Node <span class="s1">&#39;data_res2a_branch1_HzQuantize&#39;</span> is removed
modified model saved as resnet50_64x56x56_feature_modified.bin
</pre></div>
</div>
<p>Users can view the information using the <code class="docutils literal notranslate"><span class="pre">hb_model_info</span></code> tool:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>hb_model_info resnet50_64x56x56_feature_modified.bin
Start hb_model_info....
hb_model_info version <span class="m">1</span>.3.15
********* resnet50_64x56x56_feature info *********
...
--------- deleted nodes -------------------
deleted nodes: data_res2a_branch1_HzQuantize: <span class="o">[</span><span class="m">0</span>.13579604029655457<span class="o">]</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="hb_model_verifier.html" class="btn btn-neutral float-left" title="2.6. The hb_model_verifier Tool" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="hb_custom_op.html" class="btn btn-neutral float-right" title="2.8. The hb_custom_op Tool" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Horizon Robotics.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>