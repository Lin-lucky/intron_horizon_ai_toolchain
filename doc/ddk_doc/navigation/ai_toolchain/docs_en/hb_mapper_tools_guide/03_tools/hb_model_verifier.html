<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.6. The hb_model_verifier Tool &mdash; hb_mapper_tools_guide v1.12.3 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom-style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2.7. The hb_model_modifier Tool" href="hb_model_modifier.html" />
    <link rel="prev" title="2.5. The hb_pack Tool" href="hb_pack.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> hb_mapper_tools_guide
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01_model_conversion_details.html">1. Introduction To The Model Conversion Process</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../02_tools.html">2. Tools Usage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="hb_mapper.html">2.1. The <code class="docutils literal notranslate"><span class="pre">hb_mapper</span></code> Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="hb_perf.html">2.2. The <code class="docutils literal notranslate"><span class="pre">hb_perf</span></code> Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="vec_diff.html">2.3. The <code class="docutils literal notranslate"><span class="pre">vec_diff</span></code> Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_info.html">2.4. The <code class="docutils literal notranslate"><span class="pre">hb_model_info</span></code> Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="hb_pack.html">2.5. The <code class="docutils literal notranslate"><span class="pre">hb_pack</span></code> Tool</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.6. The <code class="docutils literal notranslate"><span class="pre">hb_model_verifier</span></code> Tool</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use">2.6.1. How To Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameters">2.6.2. Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-hb-model-verifier-s-configuration-file">2.6.3. The <code class="docutils literal notranslate"><span class="pre">hb_model_verifier</span></code>‚Äôs Configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parse-the-output">2.6.4. Parse The Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="hb_model_modifier.html">2.7. The <code class="docutils literal notranslate"><span class="pre">hb_model_modifier</span></code> Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="hb_custom_op.html">2.8. The <code class="docutils literal notranslate"><span class="pre">hb_custom_op</span></code> Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="hb_eval_preprocess.html">2.9. The <code class="docutils literal notranslate"><span class="pre">hb_eval_preprocess</span></code> Tool</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hb_mapper_tools_guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../02_tools.html"><span class="section-number">2. </span>Tools Usage</a> &raquo;</li>
      <li><span class="section-number">2.6. </span>The <code class="docutils literal notranslate"><span class="pre">hb_model_verifier</span></code> Tool</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/03_tools/hb_model_verifier.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="the-hb-model-verifier-tool">
<h1><span class="section-number">2.6. </span>The <code class="docutils literal notranslate"><span class="pre">hb_model_verifier</span></code> Tool<a class="headerlink" href="#the-hb-model-verifier-tool" title="Permalink to this headline">ÔÉÅ</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">hb_model_verifier</span></code> tool is used for validating specified HGM and *.bin runtime model.
It generates a random image, uses the image to inference both the HGM and
the runtime model in either simulator or dev board (üí° The board IP must be accessible
using the <code class="docutils literal notranslate"><span class="pre">ping</span></code> command), compares the inference results, so as to determine if the model can pass the validation.
If the validation image is not specified, the tool will use the default image in inference
( üí° featuremap model can randomly generate tensor data).</p>
<section id="how-to-use">
<h2><span class="section-number">2.6.1. </span>How To Use<a class="headerlink" href="#how-to-use" title="Permalink to this headline">ÔÉÅ</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>hb_model_verifier -q <span class="si">${</span><span class="nv">quanti_model</span><span class="si">}</span> <span class="se">\</span>
                  -b <span class="si">${</span><span class="nv">bin_model</span><span class="si">}</span>
                  -a <span class="si">${</span><span class="nv">board_ip</span><span class="si">}</span> <span class="se">\</span>
                  -i <span class="si">${</span><span class="nv">input_img</span><span class="si">}</span> <span class="se">\</span>
                  -d <span class="si">${</span><span class="nv">digits</span><span class="si">}</span>
</pre></div>
</div>
</section>
<section id="parameters">
<h2><span class="section-number">2.6.2. </span>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">ÔÉÅ</a></h2>
<dl class="py data">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">hb_model_verifier's</span> <span class="pre">parameters</span></span></dt>
<dd><dl class="simple">
<dt>--quanti_model, -q</dt><dd><p>Name of the quantized model.</p>
</dd>
<dt>--bin_model, -b</dt><dd><p>Name of the bin model.</p>
</dd>
<dt>--arm-board-ip, -a</dt><dd><p>The IP address of the ARM board in dev board evaluation.</p>
</dd>
<dt>--input-img, -i</dt><dd><p>The image to be used in inference test.
The default image or random tensor will be used when not specified.</p>
</dd>
<dt>--compare_digits, -d</dt><dd><p>Number of digits to be compared.
If not specified, 5 digits will be compared.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="the-hb-model-verifier-s-configuration-file">
<h2><span class="section-number">2.6.3. </span>The <code class="docutils literal notranslate"><span class="pre">hb_model_verifier</span></code>‚Äôs Configuration file<a class="headerlink" href="#the-hb-model-verifier-s-configuration-file" title="Permalink to this headline">ÔÉÅ</a></h2>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># fixed-point ONNX model file</span>
<span class="l l-Scalar l-Scalar-Plain">onnx_model</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">quantized_model.onnx</span>

<span class="c1"># path to the hybrid.bin model</span>
<span class="l l-Scalar l-Scalar-Plain">hybrid_model</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">hybrid_model.bin</span>

<span class="c1"># model input size</span>
<span class="l l-Scalar l-Scalar-Plain">input_shape</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1x224x224x3</span>

<span class="c1"># input layout of the model when running in dev board</span>
<span class="l l-Scalar l-Scalar-Plain">input_layout</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">NHWC</span>

<span class="c1"># input type (yuv444/rgb(NCHW)/feature) of the model when running in dev board</span>
<span class="l l-Scalar l-Scalar-Plain">input_type_rt</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yuv444</span>

<span class="c1"># layout input layout of the model in training</span>
<span class="l l-Scalar l-Scalar-Plain">input_layout_train</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">NCHW</span>

<span class="c1"># decimals of accuracy comparison</span>
<span class="l l-Scalar l-Scalar-Plain">compare_digits</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>

<span class="c1"># path to output results Do not use current working dir. It will be cleared</span>
<span class="l l-Scalar l-Scalar-Plain">output_dir</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">model_verifier_out</span>
</pre></div>
</div>
</section>
<section id="parse-the-output">
<h2><span class="section-number">2.6.4. </span>Parse The Output<a class="headerlink" href="#parse-the-output" title="Permalink to this headline">ÔÉÅ</a></h2>
<p>Result comparison will be displayed at the client terminal, the tool will compare the results of ONNX model operation,
simulator and dev board operations. The output is shown as below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Quanti onnx and Arm result Strict check PASSED
</pre></div>
</div>
<p>When the accuracy of HGM and runtime model is inconsistent, the specific information of inconsistent results will be output. <code class="docutils literal notranslate"><span class="pre">mismatch</span> <span class="pre">line</span> <span class="pre">num</span></code> is the number of inconsistent results of two models, including three inconsistencies: <code class="docutils literal notranslate"><span class="pre">mismatch.line_miss</span> <span class="pre">num</span></code> is the number of inconsistent output results. <code class="docutils literal notranslate"><span class="pre">mismatch.line_diff</span> <span class="pre">num</span></code> is the number of output result gaps that are too large. <code class="docutils literal notranslate"><span class="pre">mismatch.line_nan</span> <span class="pre">num</span></code> is the number of output nan. <code class="docutils literal notranslate"><span class="pre">total</span> <span class="pre">line</span> <span class="pre">num</span></code> is the total number of output data. <code class="docutils literal notranslate"><span class="pre">mismatch</span> <span class="pre">rate</span></code> refers to the proportion of inconsistent data in the total number of output data.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>INFO mismatch line num: <span class="m">39</span>
INFO ****************************
INFO mismatch.line_miss num: <span class="m">0</span>
INFO mismatch.line_diff num: <span class="m">39</span>
INFO mismatch.line_nan num: <span class="m">0</span>
INFO ****************************
INFO total line num: <span class="m">327680</span>
INFO mismatch rate: <span class="m">0</span>.0001190185546875
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<ol class="arabic simple">
<li><p>Currently the <code class="docutils literal notranslate"><span class="pre">hb_model_verifier</span></code> can only support verifying models with single input.</p></li>
<li><p>Note that the <code class="docutils literal notranslate"><span class="pre">hb_model_verifier</span></code> will only compare the first output result when a model has multiple outputs.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">hb_model_verifier</span></code> cannot validate packed *.bin models, otherwise below message will be printed at the console:</p></li>
</ol>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ERROR pack model is not supported
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="hb_pack.html" class="btn btn-neutral float-left" title="2.5. The hb_pack Tool" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="hb_model_modifier.html" class="btn btn-neutral float-right" title="2.7. The hb_model_modifier Tool" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Horizon Robotics.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>