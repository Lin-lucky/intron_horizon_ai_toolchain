

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>cnnmethod &mdash; AIExpress Solution Zoo  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> AIExpress Solution Zoo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">目录</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../README.html">参考解决方案概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../multitask_perception_solution/README.html">多任务感知参考解决方案</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../usb_camera_solution/README.html">USB CAMERA参考解决方案</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../video_box_solution/README.html">多路视频分析盒子参考解决方案</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../solution_example/yolov3_mobilenetv2_example/README.html">示例：如何基于AI-EXPRESS集成模型</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">AIExpress Solution Zoo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>cnnmethod</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../../_sources/ai_express_solution/code/common/xstream_methods/cnn_method/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cnnmethod">
<h1>cnnmethod<a class="headerlink" href="#cnnmethod" title="Permalink to this headline">¶</a></h1>
<div class="section" id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h2>
<p>cnn预测Method。目前支持人脸特征、3dpose、lmk、双目活体、人脸质量、年龄、性别、车型、车颜色、车牌号、摔倒等模型。</p>
</div>
<div class="section" id="build">
<h2>Build<a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># sh cicd/scripts/build_linux.sh, 默认编译release版，sh cicd/scripts/build_linux.sh debug 编译debug版</span>
<span class="c1"># 打包example程序与依赖的库：sh cicd/scripts/copy_runtime.sh 然后将打包好的release文件夹拷贝到开发板上就可以运行了。</span>
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test">
<h3>test<a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4>编译<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># sh build.sh</span>
</pre></div>
</div>
<p>执行build.sh脚本后，生成output目录</p>
</div>
<div class="section" id="id2">
<h4>执行<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>进入output目录, 设置lib目录后，运行test用例</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># cd output</span>
<span class="c1"># export LD_LIBRARY_PATH=./lib</span>
<span class="c1"># ./test/CNNMethod_unit_test</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>example的编译和运行：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># sh cicd/build_linux.sh</span>
<span class="c1"># scp -r build/bin username@x2_pad_ip:/run/path</span>
<span class="c1"># ssh username@x2_pad_ip</span>
<span class="c1"># cd /run/path</span>
<span class="c1"># export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:./</span>
<span class="c1"># ./CNNMethod_example get_model_info config/models/PanelBoard.hbm config/configs/bpu_config.json</span>
<span class="c1"># ./CNNMethod_example do_fb_det_cnn pose_lmk config/det_cnn_pose_lmk.json config/vio_config/vio_onsemi0230_fb.json data/det_cnn/det_cnn_list.txt data/det_cnn/det_cnn_out.txt</span>
<span class="c1"># ./CNNMethod_example do_fb_rect_cnn anti_spf  config/anti_spf.json config/vio_config/vio_onsemi0230_fb.json data/rect_cnn/anti_spf/img_lst.txt data/rect_cnn/anti_spf/anti_spf_out.txt</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>输入/输出<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id4">
<h4>输入<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>车牌识别</p>
<p>| slot | 内容    | 备注               |
| —- | ——- | —————— |
| 0    | rois    | 需要做预测的检测框 |
| 1    | pyramid | 图像的金字塔数据   |
| 2    | match_rois| 车辆车牌融合后的车牌框|</p>
<p>摔倒</p>
<p>| slot | 内容    | 备注               |
| —- | ——- | —————— |
| 0    | rois    | 需要做预测的检测框 |
| 1    | kpses   | 需要做预测的关键点   |
| 2    | disappeared_track_ids | 消失的track ids |</p>
<p>其他</p>
<p>| slot | 内容    | 备注               |
| —- | ——- | —————— |
| 0    | rois    | 需要做预测的检测框 |
| 1    | pyramid | 图像的金字塔数据   |</p>
</div>
<div class="section" id="id5">
<h4>输出<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>车牌识别模型</p>
<p>| slot | 内容     | 备注                       |
| —- | ——– | ————————– |
| 0    | plate_num| 车牌号，类型为vector<int>|</p>
<p>车型车颜色识别模型</p>
<p>| slot | 内容     | 备注                       |
| —- | ——– | ————————– |
| 0    | feature| 车型或车颜色的识别结果，类型为int|</p>
<p>活体模型</p>
<p>| slot | 内容     | 备注                       |
| —- | ——– | ————————– |
| 0    | anti_spf | 活体值，包括value和score   |
| 1    | norm_roi | 经过norm_method处理后的roi |</p>
<p>人脸特征值</p>
<p>| slot | 内容         | 备注       |
| —- | ———— | ———- |
| 0    | face_feature | 人脸特征值 |</p>
<p>人脸质量</p>
<p>| slot | 内容              | 备注           |
| —- | —————– | ————– |
| 0    | Blur              | 清晰度         |
| 1    | Brightness        | 亮度           |
| 2    | Eye_Abnormalities | 眼睛表情       |
| 3    | Mouth_Abnormal    | 嘴部表情       |
| 4    | Left_Eye          | 左眼可见区域   |
| 5    | Right_Eye         | 右眼可见区域   |
| 6    | Left_Brow         | 左眉毛可见区域 |
| 7    | Right_Brow        | 右眉毛可见区域 |
| 8    | ForeHead          | 额头可见区域   |
| 9    | Left_Cheek        | 左脸颊可见区域 |
| 10   | Right_Cheek       | 右脸颊可见区域 |
| 11   | Nose              | 鼻子可见区域   |
| 12   | Mouth             | 嘴部可见区域   |
| 13   | Jaw               | 下巴可见区域   |</p>
<p>pose+lmk</p>
<p>| slot | 内容 | 备注 |
| —- | —- | —- |
| 0    | lmk  |      |
| 1    | pose |      |</p>
<p>摔倒</p>
<p>| slot | 内容 | 备注 |
| —- | —- | —- |
| 0    | fall_list  | 摔倒值，包括value和score |</p>
</div>
</div>
<div class="section" id="id6">
<h3>配置文件<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;faceAntiSpfRGB&quot;</span><span class="p">,</span>
  <span class="nt">&quot;model_version&quot;</span><span class="p">:</span> <span class="s2">&quot;x2.1.0.11&quot;</span><span class="p">,</span>
  <span class="nt">&quot;model_file_path&quot;</span><span class="p">:</span> <span class="s2">&quot;../models/PanelBoard.hbm&quot;</span><span class="p">,</span>
  <span class="nt">&quot;bpu_config_path&quot;</span><span class="p">:</span> <span class="s2">&quot;../bpu_config/bpu_config.json&quot;</span><span class="p">,</span>
  <span class="nt">&quot;in_msg_type&quot;</span><span class="p">:</span> <span class="s2">&quot;img&quot;</span><span class="p">,</span>
  <span class="nt">&quot;norm_method&quot;</span><span class="p">:</span> <span class="s2">&quot;norm_by_lside_square&quot;</span><span class="p">,</span>
  <span class="nt">&quot;filter_method&quot;</span><span class="p">:</span> <span class="s2">&quot;no_filter&quot;</span><span class="p">,</span>
  <span class="nt">&quot;expand_scale&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
  <span class="nt">&quot;post_fn&quot;</span><span class="p">:</span> <span class="s2">&quot;antispoofing&quot;</span><span class="p">,</span>
  <span class="nt">&quot;threshold&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
  <span class="nt">&quot;max_handle_num&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
  <span class="nt">&quot;output_size&quot;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>
</pre></div>
</div>
<p>| 配置名          | 说明                                 | 备注                                                         |
| ————— | ———————————— | ———————————————————— |
| model_name      | 编译模型时指定的模型名字             |                                                              |
| model_version   | 模型版本号                           |                                                              |
| model_file_path | 模型文件地址                         |                                                              |
| bpu_config_path | bpu的配置文件地址                    |                                                              |
| in_msg_type     | 模型的处理方式（resizer或者pyramid或者ddr） | rect/img(resizer/pyramid)/lmk_seq                             |
| norm_method     | pyramid方式必填                      | norm_by_width_length<br />norm_by_width_ratio<br />norm_by_height_rario<br />norm_by_lside_ratio<br />norm_by_height_length<br />norm_by_lside_length<br />norm_by_lside_square<br />norm_by_diagonal_square<br />norm_by_nothing |
| filter_method   | pyramid方式必填                      | out_of_range<br />no_filter                                  |
| expand_scale    | pyramid方式必填                      | 外扩系数                                                     |
| post_fn         | 后处理方式                           | face_feature<br />antispoofing<br />lmk_pose<br />age_gender<br />face_quality<br />act_det |
| threshold       | 阈值                                 |                                                              |
| input_shift     | 输入转浮点时参数                      |                                                              |
| seq_len         | 输入序列长度                          |                                                              |
| stride          | 序列步长                             |  |
| max_gap         | 步长允许误差范围                      |  |
| buf_len         | 缓存buffer长度                       |                                                              |
| norm_kps_conf   | 是否强制进行关键点置信度归一化       |                                                              |
| kps_norm_scale  | 关键点置信度归一化参数                |                                                              |
| merge_groups    | 类别融合                             | 字符串，需要保证格式为”[group1_idx1,group1_idx2];[group2_idx1,group_idx2]”  |
| target_group_idx| 目标类别index                        |                                                              |
| max_handle_num       | 最大处理数量             |    负数表示无限制                                                 |
| output_size     | 输出槽的个数                         |                                                              |</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Horizon Robotics.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>