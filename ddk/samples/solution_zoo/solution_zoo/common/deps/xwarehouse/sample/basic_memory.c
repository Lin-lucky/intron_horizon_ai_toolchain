/**
 * Copyright (c) 2019 Horizon Robotics. All rights reserved.
 * @file      basic_memory.c
 * @date      2019.4.19
 */
#include <stdio.h>
#include <string.h>
#include "xwarehouse/xwarehouse.h"
#include "xwarehouse/xwarehouse_data.h"

#define TEST_INT
#define ENCRYPT_FEATURE

#define FEATURE_SIZE 128
#define SHIFT 11

#ifdef TEST_INT
#ifdef ENCRYPT_FEATURE
#define FEATURE_ATTR (SHIFT << 1)
#else
#define FEATURE_ATTR ((1 << 6) | (SHIFT << 1))
#endif
#else
#ifdef ENCRYPT_FEATURE
#define FEATURE_ATTR 1
#else
#define FEATURE_ATTR ((1 << 6) | 1)
#endif
#endif

/**
 * 特征数据保存在内存中，通过接口将特征数据注册到内存中并进行检索
 */
int main(int argc, char *argv[]) {
  //版本信息
  printf("%s\n", HobotXWHGetVersion());

  char last_model_version[50] = {"MD-0.1.15-S"};
  char current_model_version[50] = {"MD-0.1.16-S"};
  bool is_update_db;
  int ret_status = HobotXWHCheckModelVersion(current_model_version,
                                             last_model_version,
                                             &is_update_db);
  if (ret_status != Errcode_Ok) {
    printf("HobotXWHCheckModelVersion failed! ret : %d\n", ret_status);
    return -1;
  }
  printf("is_update_db = %d\n", is_update_db);

  //初始化
  HobotXWHDataSourceInfo wh_ds;
  //指定HobotXWHDataSourceType为MEMORY,其他的参数可以不用设置
  wh_ds.type_ = MEMORY;
  if (HobotXWHInit(&wh_ds) != Errcode_Ok) {
    return -1;
  }

  //创建分库
  printf("create set....\n");
  char set_name[] = "test";  // 分库名称，不为空,必须有用户指定。
  // 底库模型版本和加密key版本，创建分库的时候，必须由用户指定正确的模型版本和加密key版本。
  char model_version[] = "FaceID-X1-V3.2";  //分库模型，不为空

  //构建分库数据源信息
  HobotXWHDataSourceInfo set_ds;
  set_ds.type_ = MEMORY;
  set_ds.is_check_attr_ = 0;
  //创建底库并加载底库到内存
  int creat_status =
      HobotXWHCreateSet(set_name, model_version, FEATURE_SIZE, &set_ds);
  if (creat_status != Errcode_Ok) {
    printf("%d, HobotXWHCreateSet failed\n", creat_status);
    return -1;
  }

  //设置分库阈值
  // 距离阈值。
  // 相似度计算参数，用来计算相似度。

  if (HobotXWHSetThreshold(set_name, model_version, 194.0, 194.0) !=
      Errcode_Ok) {
    printf("HobotXWHSetThreshold failed!\n");
    return -1;
  }

  //列出SDK所加载底库
  HobotXWHListSetResult *set_result = NULL;
  if (HobotXWHListSet(&set_result) != Errcode_Ok) {
    printf("HobotXWHListSet failed\n");
    return -1;
  }
  size_t i = 0;
  for (i = 0; i < set_result->num_; ++i) {
    printf("set_name = %s\n", set_result->sets_[i].set_name_);
    printf("model_version = %s\n", set_result->sets_[i].model_version_);
    printf("feature_size = %d\n", set_result->sets_[i].feature_size_);
    printf("distance_threshold = %.4f\n",
           set_result->sets_[i].distance_threshold_);
    printf("similar_threshold = %.4f\n",
           set_result->sets_[i].similar_threshold_);
  }
  //释放set_result
  HobotXWHReleaseSetResult(&set_result);

  //新增记录
  //只修改内存中的数据，不会修改文件中的数据
  //非加密的特征
#ifndef ENCRYPT_FEATURE
#ifdef TEST_INT
  int feature_attr = FEATURE_ATTR;

  int p1_feat1[FEATURE_SIZE] =
      {-1392, -42, 67, 3978, 1355, -4885, 896, 2663, -1881, 1667, 1685, -775,
       -2016, 1443, 18, -1852, -1379, 1268, -2190, 2627, -1958, 18, -1927,
       -3665, -1664, -469, -4263, 970, 2214, -3051, 721, 1154, 3378, -2701,
       1208, 1042, 1347, -1197, -476, -647, -1418, 921, -1856, 2422, 24, -2470,
       -3005, 2361, 1728, 2005, 316, 617, 457, 1625, 849, -1041, -3665, -2875,
       -475, -516, -38, -653, -1422, -170, -1884, 2357, 2499, 1180, 231, -1233,
       -5066, 5450, -1938, 1230, -3602, 4491, -486, -2427, -2329, 731, -3510,
       -2546, -352, 89, -430, 1671, -213, -1432, 522, -1709, 2951, -64, 1902,
       -50, -235, -800, 768, 60, 1709, -1518, -1858, 1095, -2016, 1386, -2545,
       4209, 337, -4195, -948, -991, -2591, -2093, -1923, -4057, 1298, 5664,
       2681, -1521, 2410, 5063, 1474, -209, 1521, -617, -174, -1643, 578, 1617};
  int p1_feat2[FEATURE_SIZE] =
      {1883, 498, 966, 4303, 1117, -5305, 84, 3451, -18, 519, -1987, 1443,
       -1009, -127, 1609, -1522, -251, -886, -820, 5422, -1720, -2276, -2356,
       -3537, -1926, 75, -3716, 2845, 3285, -1287, 1870, -1180, 3597, -2701,
       388, 60, 394, -917, -1294, 700, -4491, -788, -1170, 2979, -60, -1186,
       -1191, -349, -390, 1588, -46, 291, -789, 3851, 650, -361, -2361, -2233,
       188, -1910, -112, 781, -501, 1696, -1844, 2315, 2346, -504, -2251, -696,
       -5216, 4319, -1518, 785, -3683, 2820, 1073, -4470, 714, 561, -3886,
       -2645, -981, 504, 899, 3325, -234, -1109, 1678, 2062, 1595, -539, 3182,
       -536, 145, -2222, 732, -1323, 548, 955, -4789, 547, -1575, -64, -1166,
       3701, 1304, -3936, -1500, -277, -2883, -2304, -576, -3446, 2044, 6780,
       2151, -2955, 1604, 3143, 330, -654, -931, -1309, -260, -678, -230, -309};
  int p1_feat3[FEATURE_SIZE] =
      {-472, -1375, -1166, 3773, 3227, -4768, 174, 2990, -2002, 1618, 522, 473,
       -804, 1603, 341, -884, -589, 2517, -1915, 2481, -2656, -266, -1465,
       -3110, -3545, -925, -3014, 153, 3552, -2720, 743, 15, 2023, -2840, 1568,
       263, 426, -1351, -941, -266, -1973, 1656, 1077, 2745, 391, -2118, -2662,
       1869, 2346, 2992, 923, 113, -1773, 2228, 95, -380, -1898, -1810, -465,
       -643, -416, -1945, 1201, 657, -2552, 2767, 1871, 1102, -1602, 331, -5177,
       3748, -34, 1551, -2446, 4444, 1602, -2492, -2425, -1999, -3801, -3056,
       -220, 533, -1134, 1063, 156, -333, 711, -2040, 3729, -1247, 1347, 462,
       -828, -1536, 440, -426, 743, -1799, -1091, 583, -1582, 160, -3463, 4903,
       909, -2631, -1028, -1635, -2902, -1709, -3264, -4383, 522, 5554, 2357,
       -2442, 2794, 2261, 1046, -297, 1019, -899, -928, -896, -508, -1272};
  int p1_feat4[FEATURE_SIZE] =
      {-1208, -1521, -2101, 4075, 1408, -4547, -707, 4226, -2354, 368, -582,
       1883, -477, 1578, 149, -1202, -238, 2121, -2965, 1781, -2388, -437,
       -2109, -3082, -2409, 308, -2474, -806, 4896, -1060, -192, -278, 2939,
       -3868, -188, 2111, 1902, -1961, -1269, 998, -2368, 1090, 41, 2833, -1272,
       -962, -3654, 1813, 1798, 2613, -807, -1218, -334, 1710, 1206, 633, 557,
       -2932, -1113, -227, -292, -569, 427, 1524, -2080, 1411, 2545, 3204, -280,
       -445, -4427, 5052, -2155, 1853, -1920, 2665, 187, -4039, 370, -397,
       -3722, -1948, -1247, -487, 519, 1198, 2119, -758, 2069, -1898, 1721,
       -885, 391, 1081, -2582, -432, -405, -1451, 127, -1860, -845, 1309, -1038,
       -380, -2865, 5579, 945, -2442, -2602, 1507, -3568, -2762, 426, -2361,
       1717, 5963, 387, -1685, 3043, 2712, -622, 31, -1304, -1358, -1130, -1735,
       -676, 497};
  int p2_feat1[FEATURE_SIZE] =
      {5238, -2044, 3172, 184, 1993, 1556, -1677, 959, 2244, 1852, 3889, -6825,
       -1788, 2381, 50, 1553, -395, -397, -1126, 263, 6275, -2096, 4323, -1949,
       -2823, 884, -1717, -1482, 1540, -3396, 541, 1532, -444, 466, -3313, 1518,
       740, -5007, -1557, 896, -1436, -2887, -939, 4586, 873, 373, 1553, -1524,
       1675, -1240, 4437, -2335, -2179, -1021, -1177, -3025, -2382, 217, 2300,
       -1859, -2367, -366, 956, -533, -1140, -2933, -1315, -2183, -1755, 413,
       2585, -899, -618, 452, -458, -352, 1810, 1102, 3417, -2474, 1479, 443,
       647, -2613, 1436, -2859, 7068, -2342, 2358, 2319, -5735, -974, -260,
       -893, 551, -835, 778, 526, -2424, 405, -1456, 2723, -2505, -20, -1152,
       -988, 3488, 829, -2965, 2222, 263, 2798, -1881, -285, 1792, -1489, -2107,
       -35, -2537, -3442, 4473, 3040, -246, -1674, 3179, -323, 746, 1735};
#else
  int feature_attr = FEATURE_ATTR;

  float p1_feat1[FEATURE_SIZE] = {
      -0.679688, -0.020996, 0.033203, 1.942871, 0.662109, -2.385254, 0.437500,
      1.300781, -0.918945, 0.813965, 0.822754, -0.378906, -0.984375, 0.704590,
      0.009277, -0.904297, -0.673340, 0.619141, -1.069336, 1.283203, -0.956055,
      0.009277, -0.940918, -1.789551, -0.812500, -0.229492, -2.081543, 0.474121,
      1.081055, -1.490234, 0.352539, 0.563477, 1.649902, -1.318848, 0.590332,
      0.509277, 0.658203, -0.584473, -0.232422, -0.315918, -0.692871, 0.450195,
      -0.906250, 1.183105, 0.012207, -1.206055, -1.467773, 1.153320, 0.844238,
      0.979492, 0.154785, 0.301270, 0.223145, 0.793945, 0.414551, -0.508301,
      -1.789551, -1.403809, -0.231934, -0.252441, -0.018555, -0.318848,
      -0.694824, -0.083496, -0.919922, 1.150879, 1.220215, 0.576660, 0.112793,
      -0.602051, -2.473633, 2.661133, -0.946777, 0.600586, -1.759277, 2.192871,
      -0.237305, -1.185059, -1.137207, 0.356934, -1.714355, -1.243652,
      -0.172363, 0.043945, -0.210449, 0.815918, -0.104492, -0.699219, 0.255371,
      -0.834473, 1.440918, -0.031738, 0.928711, -0.024902, -0.115234, -0.390625,
      0.375000, 0.029785, 0.834473, -0.741211, -0.907227, 0.534668, -0.984863,
      0.677246, -1.243164, 2.055176, 0.165039, -2.048340, -0.462891, -0.483887,
      -1.265137, -1.021973, -0.939453, -1.981445, 0.634277, 2.765625, 1.309570,
      -0.743164, 1.177246, 2.472656, 0.719727, -0.102539, 0.742676, -0.301270,
      -0.084961, -0.802734, 0.282227, 0.789551};
  float p1_feat2[FEATURE_SIZE] = {
      0.919434, 0.243652, 0.471680, 2.101562, 0.545898, -2.590332, 0.041016,
      1.685059, -0.009277, 0.253906, -0.970215, 0.705078, -0.492676, -0.062012,
      0.785645, -0.743652, -0.122559, -0.433105, -0.400391, 2.647949, -0.840332,
      -1.111816, -1.150391, -1.727051, -0.940430, 0.037109, -1.814941, 1.389648,
      1.604004, -0.628418, 0.913574, -0.576172, 1.756348, -1.318848, 0.189941,
      0.029785, 0.192871, -0.448242, -0.632324, 0.341797, -2.193359, -0.384766,
      -0.571777, 1.455078, -0.029297, -0.579102, -0.582031, -0.170898,
      -0.190430, 0.775391, -0.022461, 0.142578, -0.385254, 1.880859, 0.317383,
      -0.176270, -1.152832, -1.090820, 0.091797, -0.933105, -0.054688, 0.381348,
      -0.244629, 0.828125, -0.900391, 1.130859, 1.145508, -0.246582, -1.099609,
      -0.340332, -2.546875, 2.108887, -0.741699, 0.383301, -1.798828, 1.377441,
      0.524414, -2.183105, 0.349121, 0.273926, -1.897949, -1.291504, -0.479004,
      0.246094, 0.439453, 1.624023, -0.114258, -0.541504, 0.819336, 1.007324,
      0.778809, -0.263184, 1.553711, -0.262207, 0.071289, -1.084961, 0.357910,
      -0.646484, 0.268066, 0.466309, -2.338379, 0.267578, -0.769043, -0.031738,
      -0.569824, 1.807129, 0.636719, -1.921875, -0.732910, -0.135742, -1.408203,
      -1.125000, -0.281250, -1.683105, 0.998535, 3.311035, 1.050293, -1.443359,
      0.783691, 1.534668, 0.161133, -0.319336, -0.455078, -0.639648, -0.127441,
      -0.331055, -0.112305, -0.150879
  };
  float p1_feat3[FEATURE_SIZE] = {
      -0.230957, -0.671387, -0.569824, 1.842773, 1.575684, -2.328613, 0.085449,
      1.459961, -0.978027, 0.790527, 0.254883, 0.231445, -0.393066, 0.782715,
      0.166992, -0.431641, -0.287598, 1.229492, -0.935059, 1.211426, -1.297363,
      -0.129883, -0.715820, -1.518555, -1.730957, -0.452148, -1.471680,
      0.075195, 1.734375, -1.328613, 0.362793, 0.007812, 0.987793, -1.386719,
      0.765625, 0.128906, 0.208008, -0.659668, -0.459473, -0.130371, -0.963379,
      0.809082, 0.526367, 1.340332, 0.190918, -1.034180, -1.299805, 0.912598,
      1.145508, 1.460938, 0.450684, 0.055664, -0.865723, 1.087891, 0.046387,
      -0.185547, -0.927246, -0.884277, -0.227539, -0.313965, -0.203125,
      -0.950195, 0.586914, 0.320801, -1.246094, 1.351562, 0.914062, 0.538574,
      -0.782227, 0.162109, -2.527832, 1.830566, -0.016602, 0.757812, -1.194824,
      2.170410, 0.782227, -1.216797, -1.184570, -0.976562, -1.855957, -1.492188,
      -0.107422, 0.260742, -0.554199, 0.519043, 0.076660, -0.162598, 0.347656,
      -0.996582, 1.820801, -0.608887, 0.658203, 0.225586, -0.404297, -0.750000,
      0.215332, -0.208008, 0.362793, -0.878906, -0.533203, 0.284668, -0.772949,
      0.078613, -1.691406, 2.394531, 0.443848, -1.284668, -0.502441, -0.798828,
      -1.417480, -0.834473, -1.594238, -2.140137, 0.255371, 2.712402, 1.150879,
      -1.192871, 1.364746, 1.104004, 0.511230, -0.145020, 0.497559, -0.438965,
      -0.453125, -0.437988, -0.248047, -0.621582
  };
  float p1_feat4[FEATURE_SIZE] = {
      -0.589844, -0.742676, -1.025879, 1.990234, 0.687500, -2.220215, -0.345215,
      2.063477, -1.149902, 0.179688, -0.284180, 0.919434, -0.233398, 0.770508,
      0.073242, -0.587402, -0.116699, 1.035645, -1.447754, 0.869629, -1.166016,
      -0.213379, -1.030273, -1.505371, -1.176270, 0.150391, -1.208496,
      -0.393555, 2.390625, -0.518066, -0.093750, -0.136230, 1.435059, -1.889160,
      -0.091797, 1.030762, 0.929199, -0.957520, -0.620117, 0.487305, -1.156738,
      0.532227, 0.020020, 1.383789, -0.621582, -0.469727, -1.784180, 0.885254,
      0.877930, 1.276367, -0.394531, -0.594727, -0.163086, 0.835449, 0.589355,
      0.309570, 0.271973, -1.431641, -0.543945, -0.111328, -0.143066, -0.278320,
      0.208984, 0.744141, -1.015625, 0.688965, 1.242676, 1.564941, -0.137207,
      -0.217773, -2.162109, 2.466797, -1.052734, 0.905273, -0.937500, 1.301270,
      0.091309, -1.972168, 0.181152, -0.193848, -1.817871, -0.951660, -0.608887,
      -0.238281, 0.253418, 0.584961, 1.035156, -0.370605, 1.010742, -0.926758,
      0.840820, -0.432129, 0.191406, 0.528320, -1.261230, -0.210938, -0.197754,
      -0.708984, 0.062012, -0.908691, -0.412598, 0.639648, -0.507324, -0.185547,
      -1.398926, 2.724609, 0.461914, -1.192871, -1.270508, 0.736328, -1.742188,
      -1.349121, 0.208496, -1.152832, 0.838379, 2.911621, 0.189453, -0.822754,
      1.486328, 1.324219, -0.303711, 0.015137, -0.636719, -0.663574, -0.551758,
      -0.847168, -0.330566, 0.243164
  };
  float p2_feat1[FEATURE_SIZE] = {
      2.558105, -0.998047, 1.549316, 0.090332, 0.973145, 0.759766, -0.818848,
      0.468262, 1.096191, 0.904785, 1.898926, -3.332520, -0.873535, 1.162598,
      0.024902, 0.758789, -0.193359, -0.193848, -0.549805, 0.128418, 3.064453,
      -1.023438, 2.111328, -0.952148, -1.378418, 0.431641, -0.838379, -0.723633,
      0.752441, -1.658691, 0.264648, 0.748535, -0.217285, 0.228027, -1.617676,
      0.741699, 0.361816, -2.445312, -0.760742, 0.437988, -0.701172, -1.409668,
      -0.458984, 2.239258, 0.426270, 0.182129, 0.758789, -0.744141, 0.818359,
      -0.605469, 2.166992, -1.140137, -1.063965, -0.499023, -0.575195,
      -1.477539, -1.163574, 0.106445, 1.123535, -0.908203, -1.155762, -0.178711,
      0.467285, -0.260742, -0.556641, -1.432617, -0.642090, -1.066406,
      -0.856934, 0.202148, 1.262207, -0.439453, -0.301758, 0.221191, -0.224121,
      -0.172363, 0.884277, 0.538574, 1.668945, -1.208496, 0.722168, 0.216309,
      0.316406, -1.276367, 0.701660, -1.396484, 3.451660, -1.143555, 1.151855,
      1.132812, -2.800781, -0.476074, -0.127441, -0.436523, 0.269043, -0.407715,
      0.380371, 0.256836, -1.183594, 0.198242, -0.710938, 1.330078, -1.223145,
      -0.009766, -0.562500, -0.482422, 1.703125, 0.405273, -1.447754, 1.084961,
      0.128418, 1.366699, -0.918945, -0.139648, 0.875488, -0.727539, -1.028809,
      -0.017090, -1.238770, -1.681152, 2.184570, 1.484863, -0.120605, -0.817383,
      1.552734, -0.158203, 0.364258, 0.847656
  };
#endif

#else
  //加密后的特征
#ifdef TEST_INT
  int feature_attr = FEATURE_ATTR;

  int en_p1_feat1[FEATURE_SIZE] = {
      -297814630, -2028705399, 1617592001, 545610522, -1635253818, 132437294,
      -309906692, -1187439528, 1763212508, 1791436321, -1346571765, 869892348,
      1174664902, 974132871, -59339274, -1816376497, -690442043, 1580864692,
      1495073896, 547970484, 164813482, -178277983, 165065082, 121517096,
      -96360719, 386204796, -2003914850, -1248164486, 60054884, -125993833,
      -1366385502, 1745603490, 1499939637, 1400066638, -1984842813, 456802751,
      -1448725788, -978262618, -1142305633, -1319273850, 686205412, 308594084,
      -193328032, -1288836833, 1939246059, -1041043566, 715300421, -1378939741,
      -600065817, 514652525, -1455516758, -1745560533, -1057781862, -486914668,
      1862045222, -2060896345, 1051162759, 1341172342, -1511988202, -291149356,
      -1698130268, -1887055778, -36396, -1653795028, 743506848, 1290463333,
      380631558, -1684722732, -1718980795, 475272120, -417048493, -966902526,
      -3084293, 609435744, 1209897945, -1838657138, 603423227, 1599202107,
      1321487369, -1092856124, -1022565163, 1490452325, 18058290, 43162685,
      1632616057, 382932898, -1096973537, -461506231, -71488031, 1077687198,
      1640026947, 2143021537, 285097727, 244950002, -758131274, -244233260,
      762775712, 856948042, 1188190096, 1772922572, 1880209548, -424577201,
      1502849964, -902506903, -1211849092, -964340805, -1202594084, 876888607,
      752002193, -553873385, 1069976491, 621321468, -824909899, 968502084,
      -1702577393, 2136961232, 500395572, 804307441, -1138423912, -2022198900,
      1081584989, 1430211269, -1349729437, 1187630423, -1099580561, -728805560,
      -1370602382, -1513549918
  };
  int en_p1_feat2[FEATURE_SIZE] = {
      505348288, 1214578561, 536399240, 1569153872, 1040820308, 513955795,
      -1709416461, -1095438137, 2138151837, -2114455547, 90967885, -1551963779,
      1890963446, -493793135, -109069749, -858928866, -399816598, -723912050,
      167781442, 49843036, -701525867, -971034056, -1562995742, 572631074,
      1927672748, -218107981, 85883548, -214617649, 275991452, 193526637,
      -1563622670, -1779401882, -1500583233, -9651620, -18331715, -641476776,
      1925452364, -67878551, 1501429203, 2138171463, -462950390, -610260077,
      -78109078, 69453474, 245846179, -744356400, 1824169987, 509604932,
      177625253, -1573568042, -413255732, -2007607834, 715252806, -457934775,
      -37804324, 722498784, -592684361, 487758567, 1886451892, -473397438,
      -1883980881, 1743858519, 369029170, 861560691, 525280677, 790197740,
      -722528065, -1690034847, -708277854, -562407207, 2132894259, -391917654,
      1293169352, 293968800, -1568070054, 501280316, -731452289, -1516060241,
      -1483673618, -201844557, -583591602, 1477497839, -1412975230, 1813211549,
      2040638350, 2079417064, 1306925608, 1137025667, -323139502, 709651676,
      1496378122, -444747179, -606803902, -707186712, -1253481031, 398343871,
      1386725522, -1224935005, 197757440, -941596168, 1730724322, -1936517504,
      -1417746050, -1161187686, 1279566536, 879571460, 1241667789, -2136423030,
      2007465212, 1313535883, -1138422612, 539606651, 1116625067, -593168859,
      -1215407208, -1670061816, 752782886, -1936669986, -1947119948,
      -1419216170, -2137173163, -1214029345, 1082693021, -1849311939,
      -626148340, 414643159, 468221530, -1447275317
  };
  int en_p1_feat3[FEATURE_SIZE] = {
      960126602, 1503955056, -2027571021, 1985326355, -280788488, -429474946,
      -739930312, -13188411, -1247064881, -174544618, 1146469553, 1916199826,
      417580179, -1087662227, -1020841583, 626968220, -75778964, 1229955058,
      -1919643670, -1246076920, 410233930, -2071780586, 786645762, 271383260,
      -292733637, 530103277, -1826295240, 957594499, 747485589, -330084889,
      650227283, -1773929308, 1136710293, -2091079131, 787347589, 954105487,
      2131960514, -556627900, -2103625092, 1943235134, 1161643322, -1569462920,
      980785042, -2013990684, -1689621474, -1875921577, 1030708451, -631041047,
      1291971152, 1574323321, 39049741, 60139750, 705566373, -1856380154,
      -274515246, 564736138, -331851335, 1261704487, -1045953237, -1751266164,
      1790118717, -203686201, 601240169, 130065136, -1335476254, 729063348,
      -942637294, 1753810259, 309072272, 452865823, 818075663, -558565519,
      756759108, 1330061976, 1281656284, -275835381, -10627371, -1583619822,
      -1806607808, -1011643743, 624354687, 66453020, -1675161654, -1173089291,
      662146436, -1193669014, -75301827, 90330076, -1213486279, 1944722846,
      -1527481253, -1847637618, -2067169533, 1188928616, -894886284, 958769210,
      1782757962, 1997801330, -282425767, -764717165, 1778964959, -1996492992,
      1269024631, 595165763, 1939866780, 1605186143, 1939595845, -276764164,
      -918778836, 1244148989, -1316360196, 1950959036, -1665695948, -1923119087,
      799647114, 1784690275, -900475810, 949423480, -1675771451, -820836416,
      1080493478, -2059830941, -523089376, 1652192663, -1605452567, -743673188,
      1930295509, -147167741
  };
  int en_p1_feat4[FEATURE_SIZE] = {
      -2025787869, 982126998, 88162813, -1680301291, 1282243852, -227138755,
      2122232333, -1918523571, 1480306781, 891567026, -453126728, -814027667,
      -613445410, 1571270304, -1307853691, -652465245, 2104749981, 709134312,
      1390797853, 1794542545, 203838056, 861947516, -326045772, 852190768,
      -1169364908, 721461763, 1724897124, 1815531920, -187271637, 1361206563,
      -812887757, -1767708784, 1124152704, -714489525, 887337565, -1659705801,
      804659422, -1169716724, -52152211, 1179115483, 1387621486, -344594365,
      -1604093746, 574173090, 213716377, -776628000, -1275843748, -18617094,
      -908760667, 1352591061, -796985205, -1284857357, 1582939798, -1545352514,
      848845786, -104336630, 129727971, -1384433988, 923318071, 1470750836,
      1665567857, 686075523, 1868412358, 640184069, 1557336788, -992993615,
      -1596634807, -934088912, 1511696569, -2045278481, -19005382, -1300934610,
      1965343665, -1422345227, -2067462235, -527801694, 1276230823, 742782284,
      1432025390, -1655318327, 1209154671, -417301316, 1060297995, -372547404,
      740080289, 1362563400, 246161972, 1096445192, 1912873711, -1405787380,
      1261819828, -1982775085, 1352497878, 1491335578, -1751745290, -87299009,
      2059397392, -778285191, 16020035, 1455219267, -1566705725, -39684454,
      -2061130186, -418853334, -913567502, 37786489, 2138568867, -529921816,
      -267318149, 1460031972, 57301770, -1480004810, 1329086643, 1029555075,
      452955816, 169547106, 34786167, -1990880662, 1761057929, 432872423,
      898646685, -1930219805, 1390674295, -482797610, -1929441814, 64676475,
      250539698, -517831624
  };
  int en_p2_feat1[FEATURE_SIZE] = {
      1888523227, -1558134233, 1533560476, 1624582082, -495790083, 725495792,
      -417006085, -1460556642, 1443858819, 1434206843, -1200885305, 1576820189,
      451916318, -858638082, -1049221443, -134161977, -223135843, -1583816150,
      615461532, -1517105943, 352345557, 1327470466, -2137633690, 427014325,
      1535221587, 366171299, 738373487, 1279096335, -651344826, 1398344066,
      -1770064488, -871697165, 1788383883, -1933000798, -858653350, -1823745843,
      921620743, 1983568589, -1440259555, 1741359671, -992185029, -1321156155,
      -1697850503, 213456301, 2137979554, -1801825617, 2124557114, 495556373,
      -593794171, -243826264, -1351003057, -54163848, -347027666, 1526455987,
      -372390915, 224354548, -1459953828, 1138524078, 798991561, -336439204,
      655309490, 118399852, 1983680166, -299221619, -1432058659, -754090741,
      341430351, 622711544, -74530657, 1900300380, 136073301, -1000637029,
      2129250358, 1633342648, -1994717826, -946955985, 1101162861, 554540463,
      -1307936906, -776549176, 267035175, 1099577687, 1522930770, 1051829337,
      -94038469, -1153043716, 1852795807, -727891426, 1844548725, -964629849,
      -333689614, 155039406, -647556766, -525907608, -467855601, -1680552563,
      1719494623, -97591647, 1047118831, -774931624, -1403444167, 2039845906,
      292189582, 1118520807, 7510681, 1260194172, -1452095467, -995871030,
      -1199084348, 1153493265, 1522391973, -1957330901, -789589035, 1285068655,
      -1710859135, 58142830, -1157409634, -687507677, 1438090090, -1040963175,
      -2117222399, -795365406, 1069884986, 763399258, 119856152, -707893471,
      -875704262, 684993268
  };
#else
  int feature_attr = FEATURE_ATTR;

  int en_p1_feat1[FEATURE_SIZE] = {
      -1942001809, -873205943, 718859627, 1782798263, 1691520285, -1445476287,
      -116385327, -1259914033, 1129542508, 1894790109, 1728884614, 329107477,
      -555600202, 1688468301, -817234325, -1448798247, -1193156302, 414624412,
      1825097062, 1215714268, 83142661, -59659863, 1247832808, 2080492128,
      -449998944, 845830002, -950444580, -313565202, 1474144587, 780937196,
      558098766, 1519503374, -2110546641, 10323243, 297621173, -964088790,
      1521339161, 1687418886, 1673465542, 1121784964, 950981333, 693624023,
      397325331, 1595463141, 1233645522, -120785502, 494281730, 555281636,
      272208050, 2048670263, -748374128, 644110538, -168648211, -1533308516,
      -52376813, -908234812, 468390125, -1257225791, 970879650, -391930151,
      -1204511404, 296330610, 1062702317, -2131529433, 2075034808, -1621074592,
      1923249690, 1241480754, -1161170127, 1586102235, 473797850, -1586975005,
      -803174539, 210170026, -1824069094, 1511860166, 1735616584, -1316224227,
      -1200217126, -1845837473, 228026998, 1627019746, 1187409308, 1006962737,
      -295486329, 1117267816, -713217303, -332523214, 2029656324, -49454205,
      853636097, -651338583, -681012281, -2079812989, 2060625717, 388869040,
      2012831484, -1134846106, -1160391817, -400742138, 1550373652, -1888083935,
      -277498341, 1819126667, -326463684, 342587253, 297042559, -748724240,
      243947486, -1374671750, 1301990704, 1469423375, 507595428, -1012918611,
      808634534, -1121712966, 1845742423, -1042302943, -728502652, 2054260840,
      1289169323, -1537947333, -2144114504, -1855536168, -45486671, -1995756257,
      -1972122168, -1452373406
  };
  int en_p1_feat2[FEATURE_SIZE] = {
      1462686998, 120882407, 81601333, 1178822725, -270783708, -439067292,
      -963527186, 741594314, -953178673, 854456120, 209468347, -3788977,
      -880476183, -560051591, -1828104953, 1158216119, -1376900276, -2047280168,
      -1988025944, -1403479481, -1493529301, 1313077922, -641567379, 1881879518,
      1102219484, 615028893, -1111704457, 914177828, 1441638904, -1507261655,
      581359436, -635611537, -958201863, 304403484, 787907872, 751101243,
      299509169, -333302839, 116159786, 1151255292, -1471639970, 1259979173,
      1753394678, 1890917723, -1987309015, -1004776505, -2033604324, 780930021,
      -1995746933, 617078715, 838108310, -496484303, 157133292, 1804494592,
      -1527072257, 1828804296, -1859283702, -2108879515, 1139202507, 351279043,
      -170218647, 753838647, 1666941921, 1980823282, 1371253843, 52486749,
      -1961855218, -1956100762, -84588310, -1138361478, 994007440, -609870247,
      -1678197520, 1628800048, 853041294, -1241582999, 118975272, 1553831340,
      -210342788, 265500617, 970968449, -1340221258, -1641333150, 862140251,
      -1792889359, 36512415, 1152707602, -1369041373, -173646036, 1830080769,
      964868319, -1939197177, -1788441584, 170025569, -1113536100, 751010083,
      -1591070570, 930098464, -512425239, -1162009019, 823143959, 1065718691,
      773959820, 638154070, 1513729478, 215532800, -429302644, -898044950,
      767568428, -1921744825, 59743531, 1402819538, 1418808047, 2103455285,
      -1394867819, 1048878992, 1671847108, -2088366685, 1312902161, -756533285,
      -486449208, 1297843404, 288061157, 384711762, 1592942432, -1239353815,
      662585143, 293711425
  };
  int en_p1_feat3[FEATURE_SIZE] = {
      -286427301, 246540152, 324288321, -621180140, 1701198130, -1958851062,
      802123166, -911947056, -55205580, 905001812, 592050987, -523397258,
      920317142, -1853425249, 724874072, 1065085832, 1227384789, -1698720636,
      849246832, -1835237441, -1428088564, -408062944, 48758597, 882609818,
      525618257, 1472403090, 2018324121, -577098717, 1698371893, 1910135941,
      -750206047, -684153141, 81232357, 1630133363, -918912824, 1846911180,
      -1319410676, -696291124, -2127283753, 1947749387, -99406716, 466589440,
      1906395286, -1904495110, -1933219776, -519880716, 932627236, -1177269731,
      379045054, -925674399, -601229470, -1697109966, -1446887069, 587590379,
      826605362, 1782654488, 1126163100, -2017304159, 200302306, 1236687094,
      -1537408552, -1927128423, -1914953799, -7835756, 468400529, -603936181,
      -1991421053, -912700259, -1260746981, 471878602, -709899594, 653330087,
      -936614561, -1546086069, -1792053563, -952235182, -1066829289, 766717973,
      705043485, -1394534648, -809001514, -1169547505, -374508940, 664613244,
      2023275195, -1919410905, -926365974, -1394288549, 534627767, -1410879287,
      -1793162948, 554470552, -1147414045, 1265455772, -1332635590, 2000564811,
      1501162178, 773634629, 413375837, 1715700469, 1426345125, 1825797340,
      -1870417274, -321007090, -1732057390, -561656194, -2051082981,
      -1937917511, 705195850, -1466765461, -989069991, -1517335798, 304588917,
      -1215335946, 356400369, 615634348, 1906357862, 1289064072, 1904745790,
      -762853992, 944292508, -1208478604, -930331693, 690780075, 2130303547,
      -1897769826, 1915322844, 347863243
  };
  int en_p1_feat4[FEATURE_SIZE] = {
      411770123, -601872313, 1361094540, 154012464, 86576633, -1489430435,
      1540768683, -470723001, -1378146329, -541403006, -1460966512, 1006833760,
      -319445627, -336545382, -477738455, 203097964, -679724125, 1938085500,
      -42223847, 1295962054, -349970244, 1840641546, -912097, -864115014,
      1042000944, -448267187, 2132295276, 894051654, 1016121129, -1184185587,
      -1212408683, -1840213107, -1916588430, -37124344, -1500427470, -260785307,
      568728768, -2080094445, 1592040338, -816364989, 1795440327, -872166835,
      254183041, 1593995127, 362113274, 267920383, -1206232219, -2128008495,
      -2089270655, 1672857544, -1638064201, 1649136808, 1850194004, -1307982846,
      367796208, -1572333108, -2005281159, 235490072, -1430710524, -1550289082,
      -377507950, -705716412, -1904721292, -343582732, -1617828494, -1189955725,
      1467786295, 1651621652, -2048736321, 1381167403, -1395509709, 55453812,
      -1444097637, -952089215, -1887612854, 981761009, -1645442411, 229669126,
      1846396958, 1699323109, 1233569335, -608204504, 1178843319, -2105236980,
      -884594642, -2054112609, -1867518185, -635363683, -875413843, 1283579543,
      1952775143, -393037500, -1373506868, 1433484659, 582047382, 1647121539,
      -1524951807, 1528934550, 1943143270, -583095898, -1697689234, 1473685971,
      -1911787554, 904551052, -852822449, 1030440006, 1883965196, 543980825,
      1580779541, 227605108, 1302982748, 2112539166, -2024239219, -1654224783,
      -2081915052, -1102099942, 753267608, -1978576593, -1886365385, 1930086874,
      1241935068, 892217176, -1902253941, -1478881329, 1292597110, -66715962,
      1546396413, 909462311
  };
  int en_p2_feat1[FEATURE_SIZE] = {
      485787523, -812676559, -571220299, 192667559, -778223262, 499713801,
      1107348338, -1266098612, 52544278, 833367465, 965264636, 2082485499,
      63018525, 665624725, 254331565, 363096598, 555664594, 1835836562,
      976899059, 1928293906, -188364619, -140664860, -1205065716, -1971985004,
      1043304819, -1247758923, -332579795, 129347890, 775872032, -280689230,
      -27797655, 1199861422, -684152778, -1446137209, -715746032, -160146720,
      -420617934, 1307404497, 271825619, 501828958, 1965005985, 1311546653,
      -1486262024, -617155603, 1895039170, 747428976, -366036168, -101618879,
      -1180433995, 155316364, -495068136, -1917950738, -1067945191, 1963898122,
      -1063335606, -1457941665, -1682752808, 1536442269, 1996536861, -974769,
      -741165203, 538166135, 2036514472, -1860895277, 879608238, -673516250,
      795739376, 1421323718, -1144303869, 1891166159, 425846032, -1709540392,
      1763138613, -1378431650, 285855013, -1544275402, 801921343, -332015263,
      799506041, 218876945, -1444485515, 1234803016, -586165733, -1317331560,
      119248601, 616367920, 1351957780, 1573349337, 52625836, 2103662614,
      325561737, -467274045, 1811789652, -1783172647, 326068720, -597306229,
      -626514139, -913279554, -179448912, 1984269142, 1269178234, -1494860929,
      -895626168, -1955315561, -840931617, 272075124, 107039319, 1691745469,
      95356085, 2135195936, -910636560, 1561250074, 1775781083, -1534148016,
      7735044, 1930029259, -1648256584, -3387017, 2126327098, 2089373409,
      1964553267, -625263371, -1787267794, -1302916107, 188820687, -178005558,
      1888417214, -1659670376
  };
#endif
#endif

  HobotXWHRecord record;
  char id[] = "person-1";
  strncpy(record.id_, id, HOBOT_ID_LENGTH);
  record.size_ = 2;
  HobotXWHFeature feature[2];
  record.features_ = feature;
  strncpy(record.features_[0].img_uri_, "feat-1", HOBOT_URI_LENGTH);
  record.features_[0].size_ = FEATURE_SIZE;
  record.features_[0].feature_attr_ = feature_attr;
#ifdef ENCRYPT_FEATURE
  record.features_[0].feature_ = en_p1_feat1;
#else
  record.features_[0].feature_ = p1_feat1;
#endif

  strncpy(record.features_[1].img_uri_, "feat-2", HOBOT_URI_LENGTH);
  record.features_[1].size_ = FEATURE_SIZE;
  record.features_[1].feature_attr_ = feature_attr;
#ifdef ENCRYPT_FEATURE
  record.features_[1].feature_ = en_p1_feat2;
#else
  record.features_[1].feature_ = p1_feat2;
#endif

  int ret = HobotXWHAddRecord(set_name, model_version, &record);
  if (ret != Errcode_Ok) {
    printf("add record failed, %d\n", ret);
    return -1;
  }

  HobotXWHFeature add_feature[1];
  strncpy(add_feature->img_uri_, "feat-3", HOBOT_URI_LENGTH);
  add_feature[0].size_ = FEATURE_SIZE;
  add_feature[0].feature_attr_ = feature_attr;
#ifdef ENCRYPT_FEATURE
  add_feature[0].feature_ = en_p1_feat3;
#else
  add_feature[0].feature_ = p1_feat3;
#endif

  ret = HobotXWHAddFeature(set_name, model_version, id, add_feature);
  if (ret != Errcode_Ok) {
    printf("add feature failed, %d\n", ret);
    return -1;
  }

  //列出底库下所有的记录
  HobotXWHListRecordResult *listRecordResult = NULL;
  ret = HobotXWHListRecord(set_name, model_version, &listRecordResult);
  if (ret != Errcode_Ok) {
    printf("HobotXWHListRecord failed\n");
    return -1;
  }
  //打印结果
  size_t j = 0;
  for (i = 0; i < listRecordResult->num_; ++i) {
    printf("id = %s\n", listRecordResult->record_[i].id_);
    for (j = 0; j < listRecordResult->record_[i].size_; ++j) {
      printf("url = %s\t", listRecordResult->record_[i].features_[j].img_uri_);
    }
  }
  printf("\n");
  // 释放结果内存
  HobotXWHReleaseListRecordResult(&listRecordResult);

  //删除特征
  if (HobotXWHDeleteFeature(set_name, model_version, id, "feat-3") !=
      Errcode_Ok) {
    printf("HobotXWHDeleteFeature error\n");
    return -1;
  }

  //查看某个记录的信息
  HobotXWHListFeatureResult *listFeatureResult = NULL;
  ret = HoboXWHListFeature(set_name, model_version, id, &listFeatureResult);
  if (Errcode_Ok != ret) {
    printf("HoboXWHListFeature error\n");
    return -1;
  }
  printf("id = %s\n", listFeatureResult->record_.id_);

  for (i = 0; i < listFeatureResult->record_.size_; ++i) {
    printf("url = %s\t", listFeatureResult->record_.features_[i].img_uri_);
  }
  printf("\n");

  HobotXWHReleaseListFeatureResult(&listFeatureResult);

  //检索
  //检索前申请内存
  HobotXWHSearchResult *result = HobotXWHAllocSearchResult();
  for (i = 0; i < 1; i++) {
    //构建检索的参数
    HobotXWHSearchParam searchParam;
    searchParam.top_n_ = 5;  // top_N
    // 距离阈值。可以设置为-1，设置为-1的时候，实际使用的阈值是接口HobotXWHSetThreshold里设置的值。
    // 如果需要更新阈值，采用跟HobotXWHSetThreshold接口不一样的阈值的话，
    // 模型版本是IPC3.0均建议距离阈值设为194。否则，应根据实际模型版本来给出一个合理的阈值。

    searchParam.similar_threshold_ = 194.0;
    // 相似度计算参数。可以设置为-1，设置为-1的时候，实际使用的阈值是接口HobotXWHSetThreshold里设置的值。
    // 如果需要更新阈值，采用跟HobotXWHSetThreshold接口不一样的阈值的话，
    // 模型版本是IPC3.0均建议相似度计算参数设为194。否则，应根据实际模型版本来给出一个合理的计算参数。
    searchParam.distance_threshold_ = 194.0;
    searchParam.size_ = 1;
    HobotXWHFeature features[1];
    searchParam.features_ = features;
    searchParam.features_[0].size_ = FEATURE_SIZE;
    searchParam.features_[0].feature_attr_ = feature_attr;
#ifdef ENCRYPT_FEATURE
    searchParam.features_[0].feature_ = en_p1_feat4;
#else
    searchParam.features_[0].feature_ = p1_feat4;
#endif
    int ret = HobotXWHSearch(set_name, model_version, &searchParam, result);
    if (ret != Errcode_Ok) {
      printf("search failed, %d\n", ret);
      return -1;
    }
    if (result) {
      // printf("is_matched = %d\n", result->is_matched_);
      size_t i = 0;
      for (i = 0; i < result->num_; ++i) {
        printf("id = %s, dis = %.4f, sim = %.4f\n", result->id_score_[i].id_,
               result->id_score_[i].distance_, result->id_score_[i].similar_);
      }
    }
  }
  //检索完后释放内存
  HobotXWHReleaseSearchResult(&result);
  // 1:1比对
  HobotXWHRecord record1, record2;
  record1.size_ = 1;
  HobotXWHFeature features1[1];
  features1[0].size_ = FEATURE_SIZE;
  features1[0].feature_attr_ = feature_attr;
#ifdef ENCRYPT_FEATURE
  features1[0].feature_ = en_p1_feat1;
#else
  features1[0].feature_ = p1_feat1;
#endif
  record1.features_ = features1;

  record2.size_ = 1;
  HobotXWHFeature features2[1];
  features2[0].size_ = FEATURE_SIZE;
  features2[0].feature_attr_ = feature_attr;
#ifdef ENCRYPT_FEATURE
  features2[0].feature_ = en_p1_feat2;
#else
  features2[0].feature_ = p1_feat2;
#endif
  record2.features_ = features2;

  HobotXWHCompareResult compare_result;
  ret =
      HobotXWHFeatureCompare1V1(&record1, &record2, 194, 194, &compare_result);
  if (ret != Errcode_Ok) {
    printf("HobotXWHFeatureCompare1V1 error!\n");
  }

  printf("is_matched = %d, distance = %.4f, similar = %.4f\n",
         compare_result.is_matched_, compare_result.distance_,
         compare_result.similar_);
  // HobotXWHDropSet(set_name, model_version);
  HobotXWHClose();
  printf("The End!\n");
  return 0;
}
